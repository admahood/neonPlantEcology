tidyr::pivot_wider(names_from = family,
names_prefix = "rc_exotic_",
values_from = (rel_cover),
values_fill = list(rel_cover = 0)) %>%
dplyr::select(-nativeStatusCode)
rc_ng<- exotic_grass%>%
dplyr::select(site, plotID, subplotID,year, family, nativeStatusCode,rel_cover) %>%
dplyr::filter(nativeStatusCode == "N") %>%
tidyr::pivot_wider(names_from = family,
names_prefix = "rc_native_",
values_from = (rel_cover),
values_fill = list(rel_cover = 0)) %>%
dplyr::select(-nativeStatusCode)
c_ig<- exotic_grass%>%
dplyr::select(site, plotID, subplotID,year, family, nativeStatusCode,cover) %>%
dplyr::filter(nativeStatusCode == "I") %>%
tidyr::pivot_wider(names_from = family,
names_prefix = "cover_exotic_",
values_from = (cover),
values_fill = list(cover = 0)) %>%
dplyr::select(-nativeStatusCode)
c_ng<- exotic_grass%>%
dplyr::select(site, plotID, subplotID,year, family, nativeStatusCode,cover) %>%
dplyr::filter(nativeStatusCode == "N") %>%
tidyr::pivot_wider(names_from = family,
names_prefix = "cover_native_",
values_from = (cover),
values_fill = list(cover = 0)) %>%
dplyr::select(-nativeStatusCode)
}
# vegan::diversity indexes splitting between native status ==========================
# exotic ===============
vegan_friendly_div_ex<- full_on_cover %>%
dplyr::filter(nativeStatusCode %in% c("I")) %>%
dplyr::group_by(site, plotID, subplotID,taxonID, year) %>%
dplyr::summarise(cover = sum(cover, na.rm = TRUE)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::group_by(site, plotID, subplotID, year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
# note to self - hard code! gotta fix it
nspp_ex <- vegan_friendly_div_ex %>%
dplyr::select(site, plotID, subplotID,year) %>%
mutate(shannon_exotic = vegan::diversity(vegan_friendly_div_ex %>%
dplyr::select(-site,
-plotID,
-subplotID,
-year)),
nspp_exotic = vegan::specnumber(vegan_friendly_div_ex %>%
dplyr::select(-site,
-plotID,
-subplotID,
-year)))
# native ===========
vegan_friendly_div_n<- full_on_cover %>%
dplyr::filter(nativeStatusCode %in% c("N")) %>%
dplyr::group_by(site, plotID, subplotID,taxonID, year) %>%
dplyr::summarise(cover = sum(cover, na.rm = TRUE)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::group_by(site, plotID, subplotID, year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
nspp_n <- vegan_friendly_div_n %>%
dplyr::select(site, plotID, subplotID,year) %>%
mutate(shannon_native = vegan::diversity(vegan_friendly_div_n %>%
dplyr::select(-site,
-plotID,
-subplotID,
-year)),
nspp_native = vegan::specnumber(vegan_friendly_div_n %>%
dplyr::select(-site,
-plotID,
-subplotID,
-year)))
# unknown ========================
vegan_friendly_div_un<- full_on_cover %>%
dplyr::filter(nativeStatusCode %in% c("UNK")) %>%
dplyr::group_by(site, plotID, subplotID,taxonID, year) %>%
dplyr::summarise(cover = sum(cover, na.rm = TRUE)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::group_by(site, plotID, subplotID, year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
nspp_un <- vegan_friendly_div_un %>%
dplyr::select(site, plotID, subplotID,year) %>%
mutate(shannon_unknown = vegan::diversity(vegan_friendly_div_un %>%
dplyr::select(-site,
-plotID,
-subplotID,
-year)),
nspp_unknown = vegan::specnumber(vegan_friendly_div_un %>%
dplyr::select(-site,
-plotID,
-subplotID,
-year)))
# total vegan::diversity - not splitting between native status
vegan_friendly_div_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
div_total <- dplyr::select(vegan_friendly_div_total, site, plotID, subplotID,year) %>%
mutate(shannon_total = vegan::diversity(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year)),
nspp_total = vegan::specnumber(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year)))
# joining and writing out ------------------------------------------------------
final_table <- dplyr::left_join(nspp_ex,nspp_n, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(nspp_un, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(n_i_cover, by = c("site", "plotID", "subplotID","year")) %>%
dplyr::left_join(n_i_rel_cover, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(div_total, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::mutate(scale = scale,
invaded = if_else(cover_exotic > 0, "invaded", "not_invaded"))#%>%
#dplyr::mutate(scale = factor(scale, levels = c("1m","10m","100m", "plot", "site")))
if(!is.na(families)){
final_table <- final_table %>%
dplyr::left_join(rcf, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(rc_ig, by = c("site", "plotID", "subplotID", "year"))%>%
dplyr::left_join(c_ig, by = c("site", "plotID", "subplotID", "year"))%>%
dplyr::left_join(cf, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(rc_ng, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(c_ng, by = c("site", "plotID", "subplotID", "year"))%>%
dplyr::left_join(nspp_byfam, by = c("site", "plotID", "subplotID", "year"))}
if(!is.na(spp)){
final_table <- final_table %>%
dplyr::left_join(rc_sp, by = c("site", "plotID", "subplotID", "year")) %>%
dplyr::left_join(c_sp, by = c("site", "plotID", "subplotID", "year"))}
# seems crazy, i know... but those NAs should all definitely be zero
final_table <- final_table %>%
mutate_all(funs(replace(., is.na(.), 0)))
return(final_table)
}
devtools::document()
devtools::install()
devtools::install()
devtools::install()
neon_div_object <- neondiveRsity::download_plant_div("SRER")
get_diversity_info(neon_div_object)
library(neondiveRsity)
get_diversity_info(neon_div_object)
get_diversity_info(neon_div_object, scale="site")
get_diversity_info(neon_div_object, scale="1m")
neondiveRsity::download_plant_div("SRER") -> xx
scale <- "site"
trace_cover <- 0.5
fix_unks = FALSE
neon_div_object <- xx
full_on_cover <- get_longform_cover(neon_div_object,
scale = scale,
fix_unks = fix_unks)
library(neondiveRsity)
full_on_cover <- get_longform_cover(neon_div_object,
scale = scale,
fix_unks = fix_unks)
template <- full_on_cover %>%
dplyr::select(site, plotID, subplotID, year)
template
full_on_cover
detach("package:neondiveRsity", unload = TRUE)
devtools::document()
devtools::install()
remove.packages("neondiveRsity")
install_github("admahood/neondiveRsity")
devtools::install_github("admahood/neondiveRsity")
neondiveRsity::get_diversity_info(xx, scale="site")
neondiveRsity::get_diversity_info(neon_div_object = neondiveRsity::download_plant_div("ABBY"), scale="site")->test
test
get_diversity_info
neondiveRsity::get_diversity_info
library(neondiveRsity)
get_longform_cover()
get_longform_cover
remove.packages("neondiveRsity")
devtools::install_github("admahood/neondiveRsity")
neondiveRsity::get_diversity_info(neon_div_object = neondiveRsity::download_plant_div("ABBY"), scale="site")->test
tesyt
test
x <- download_plant_div("SRER")
library(neondiveRsity)
x <- download_plant_div("SRER")
get_diversity_info(x, "site")
devtools::document()
devtools::install()
library(neondiveRsity)
library(tidyverse)
x <- download_plant_div("ABBY")
get_diversity_info(x, "site")
get_diversity_info(x, "site") %>% unique()
get_longform_cover(x, "site")
get_longform_cover(x, scale ="site")
get_longform_cover(x, scale ="site") %>% unique()
devtools::document()
devtools::install()
library(neondiveRsity)
download_plant_div("ABBY") -> neon_div_object
scale = "plot"
get_diversity_info(neon_div_object, "site")
get_diversity_info(neon_div_object, "plot")
scale = "plot"
trace_cover = 0.5
fix_unks = FALSE
name_cleaner = FALSE
families = NA
spp = NA
full_on_cover <- get_longform_cover(neon_div_object,
scale = scale,
fix_unks = fix_unks)
template <- full_on_cover %>%
dplyr::select(site, plotID, subplotID, year)
# total vegan::diversity - not splitting between native status
vegan_friendly_div_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
vegan_friendly_div_total
full_on_cover
# family diversity ===========================================================
vegan_friendly_div_total_f <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, family, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
# family diversity ===========================================================
vegan_friendly_div_total_f <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, family, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::filter(!is.na(family)) %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(family, cover, fill=0) %>%
dplyr::ungroup()
# family diversity ===========================================================
vegan_friendly_div_total_f <- full_on_cover %>%
dplyr::filter(!is.na(family)) %>%
dplyr::group_by(site, plotID, subplotID, family, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(family, cover, fill=0) %>%
dplyr::ungroup()
vegan_friendly_div_total_f
# family diversity ===========================================================
vegan_friendly_div_total_f <- full_on_cover %>%
dplyr::filter(!is.na(family)) %>%
dplyr::group_by(site, plotID, subplotID, family, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(family, cover, fill=0) %>%
dplyr::ungroup()
div_total_f <- dplyr::select(vegan_friendly_div_total_f, site, plotID, subplotID,year) %>%
mutate(shannon_family = vegan::diversity(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year)),
evenness_family = shannon_family/vegan::specnumber(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year)),
nfamilies = vegan::specnumber(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year)))
div_total_f
div_total_f <- dplyr::select(vegan_friendly_div_total_f, site, plotID, subplotID,year) %>%
mutate(shannon_family = vegan::diversity(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year)),
evenness_family = shannon_family/vegan::specnumber(vegan_friendly_div_total_f%>%
dplyr::select(-site, -plotID, -subplotID, -year)),
nfamilies = vegan::specnumber(vegan_friendly_div_total_f%>%
dplyr::select(-site, -plotID, -subplotID, -year)))
div_total_f
full_on_cover %>%
dplyr::filter(!is.na(family)) %>%
dplyr::group_by(site, plotID, subplotID, family, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup()
nspp_byfam <- full_on_cover%>%
dplyr::filter(nativeStatusCode %in% c("I", "N", "UNK")) %>%
dplyr::group_by(site, plotID, subplotID, year) %>%
dplyr::mutate(total_cover = sum(cover))%>%
dplyr::ungroup() %>%
dplyr::group_by(site, plotID, subplotID,year, family, nativeStatusCode) %>%
dplyr::summarise(nspp = length(unique(scientificName))) %>%
dplyr::ungroup() %>%
dplyr::filter(family %in% families) %>%
tidyr::pivot_wider(names_from = c(family, nativeStatusCode),
names_prefix = "nspp_",
values_from = (nspp),
values_fill = list(nspp = 0))
nspp_byfam
families = "Poaceae"
nspp_byfam <- full_on_cover%>%
dplyr::filter(nativeStatusCode %in% c("I", "N", "UNK")) %>%
dplyr::group_by(site, plotID, subplotID, year) %>%
dplyr::mutate(total_cover = sum(cover))%>%
dplyr::ungroup() %>%
dplyr::group_by(site, plotID, subplotID,year, family, nativeStatusCode) %>%
dplyr::summarise(nspp = length(unique(scientificName))) %>%
dplyr::ungroup() %>%
dplyr::filter(family %in% families) %>%
tidyr::pivot_wider(names_from = c(family, nativeStatusCode),
names_prefix = "nspp_",
values_from = (nspp),
values_fill = list(nspp = 0))
nspp_byfam
betadiver(vegan_friendly_div_total)
vegan_friendly_div_total
?vegan::betadiver()
?vegan::nestedbetasor()
?vegan::nestedbetasor(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year))
vegan::nestedbetasor(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year))
vegan::nestedbetajac(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year))
vegan::nestedbetajac(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -year))
vegan::nestedbetajac(vegan_friendly_div_total%>%
dplyr::select(-site, -plotID, -subplotID, -year))
full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup()
full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID, subplotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select() %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac(.)[2])
full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup()
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac(.)[2])
full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year)
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac()[2])
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac(.)[2])
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac(.[3:ncol(.)])[2])
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac(.[3:ncol(.)]))
dplyr::select(-site, -plotID, -subplotID, -year))
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID) %>%
dplyr::group_by(site, plotID, year) %>%
dplyr::summarise(nestedness = vegan::nestedbetajac(.[3:ncol(.)]))
i="ABBY_001"
j = "2016"
k = "ABBY"
betadiv_total %>%
filter(plotID == i, year == j, site == k) %>%
dplyr::select(-plotID, -site, -year) %>%
nestedbetajac()
betadiv_total <- full_on_cover %>%
dplyr::group_by(site, plotID, subplotID, taxonID, year) %>%
dplyr::summarise(cover = sum(cover)) %>%
dplyr::ungroup() %>%
dplyr::mutate(taxonID = as.character(taxonID),
plotID = as.character(plotID)) %>%
dplyr::filter(nchar(as.character(taxonID))>0) %>%
dplyr::group_by(site, plotID,year) %>%
tidyr::spread(taxonID, cover, fill=0) %>%
dplyr::ungroup() %>%
dplyr::select(-subplotID)
betadiv_total %>%
filter(plotID == i, year == j, site == k) %>%
dplyr::select(-plotID, -site, -year) %>%
nestedbetajac()
betadiv_total %>%
filter(plotID == i, year == j, site == k)
year = 2018
betadiv_total %>%
filter(plotID == i, year == j, site == k)
i=2018
betadiv_total %>%
filter(plotID == i, year == j, site == k)
i="2018"
betadiv_total %>%
filter(plotID == i, year == j, site == k)
betadiv_total
betadiv_total[,1:3]
devtools::document()
devtools::install()
